# 2025年1月7日 JVM进阶知识点问答学习记录

## 学习主题：JVM进阶知识点深度问答（续接昨日）

### 知识点21：常见的垃圾收集器有哪些？它们各自的特点是什么？

**对话：**

老师：常见的垃圾收集器有哪些？它们各自的特点是什么？

用户：Serial、Parallel、CMS、G1、ZGC。Serial是单线程，适合客户端；Parallel是多线程，适合服务器；CMS是并发收集，减少停顿；G1是分区收集，可预测停顿；ZGC是低延迟，大堆内存。

老师：CMS收集器为什么会被淘汰？

用户：CMS会产生内存碎片，Full GC时停顿时间长。G1和ZGC更适合现代应用。

---

### 知识点22：G1垃圾收集器的工作原理是什么？

**对话：**

老师：G1垃圾收集器的工作原理是什么？

用户：G1将堆分成多个Region，优先回收垃圾最多的Region。通过Remembered Set记录跨Region引用。目标是达到可预测的停顿时间。

老师：Remembered Set的作用是什么？

用户：记录Region之间的引用关系，避免全堆扫描。

---

### 知识点23：ZGC和Shenandoah收集器有什么特点？

**对话：**

老师：ZGC和Shenandoah收集器有什么特点？

用户：都是低延迟收集器，停顿时间不超过10ms。ZGC使用染色指针，Shenandoah使用Brooks指针。都支持TB级别堆内存。

老师：染色指针技术有什么优势？

用户：染色指针将元数据存储在指针中，减少内存访问开销。

---

### 知识点24：什么是类加载机制？类加载的过程是怎样的？

**对话：**

老师：什么是类加载机制？类加载的过程是怎样的？

用户：类加载机制是将.class文件加载到内存，并转换为Class对象的过程。包括加载、验证、准备、解析、初始化五个阶段。

老师：验证阶段验证什么内容？

用户：验证文件格式、元数据、字节码、符号引用等。

---

### 知识点25：什么是双亲委派模型？它的作用是什么？

**对话：**

老师：什么是双亲委派模型？它的作用是什么？

用户：双亲委派模型是类加载器的工作机制。子加载器先委托父加载器加载，父加载器无法加载时子加载器才尝试。作用是保证类的唯一性和安全性。

老师：如何打破双亲委派模型？

用户：重写loadClass方法，或者使用线程上下文类加载器。

---

### 知识点26：Java中有哪些内置的类加载器？它们的关系是怎样的？

**对话：**

老师：Java中有哪些内置的类加载器？它们的关系是怎样的？

用户：Bootstrap、Extension、Application类加载器。Bootstrap加载核心类，Extension加载扩展类，Application加载应用类。形成父子关系。

老师：Bootstrap类加载器是用什么语言实现的？

用户：用C++实现，是JVM的一部分。

---

### 知识点27：什么是自定义类加载器？有什么应用场景？

**对话：**

老师：什么是自定义类加载器？有什么应用场景？

用户：自定义类加载器是用户自己实现的类加载器。应用场景包括热部署、模块化、代码加密、从网络加载类等。

老师：如何实现自定义类加载器？

用户：继承ClassLoader类，重写findClass方法。

---

### 知识点28：什么是运行时数据区？各个区域的作用是什么？

**对话：**

老师：什么是运行时数据区？各个区域的作用是什么？

用户：运行时数据区是JVM运行时的内存结构。包括程序计数器、虚拟机栈、本地方法栈、堆、方法区。程序计数器记录执行位置，栈存储方法调用，堆存储对象，方法区存储类信息。

老师：程序计数器为什么是线程私有的？

用户：每个线程需要独立记录自己的执行位置。

---

### 知识点29：什么是方法区？JDK 1.8之后方法区有什么变化？

**对话：**

老师：什么是方法区？JDK 1.8之后方法区有什么变化？

用户：方法区存储类信息、常量、静态变量等。JDK 1.8用元空间替代永久代，元空间使用本地内存，不再受JVM堆大小限制。

老师：元空间会溢出吗？

用户：会，当本地内存不足或类加载太多时。

---

### 知识点30：什么是常量池？字符串常量池有什么特点？

**对话：**

老师：什么是常量池？字符串常量池有什么特点？

用户：常量池存储字面量和符号引用。字符串常量池在堆中，可以避免重复创建字符串，提高内存利用率。

老师：字符串常量池在JDK 1.7之后有什么变化？

用户：从方法区移到堆中，可以更好地被垃圾回收。

---

### 知识点31：什么是直接内存？它和堆内存有什么区别？

**对话：**

老师：什么是直接内存？它和堆内存有什么区别？

用户：直接内存是JVM之外的内存，通过NIO的DirectByteBuffer分配。不受JVM垃圾回收管理，访问速度更快。

老师：直接内存有什么缺点？

用户：分配和回收成本高，容易内存泄漏。

---

### 知识点32：什么是JVM参数？常见的JVM参数有哪些？

**对话：**

老师：什么是JVM参数？常见的JVM参数有哪些？

用户：JVM参数是启动JVM时设置的配置选项。常见参数：-Xmx设置最大堆内存，-Xms设置初始堆内存，-Xss设置栈大小，-XX:+UseG1GC使用G1收集器。

老师：-XX:MaxMetaspaceSize参数的作用是什么？

用户：设置元空间的最大大小。

---

### 知识点33：如何监控JVM的运行状态？常用的监控工具有哪些？

**对话：**

老师：如何监控JVM的运行状态？常用的监控工具有哪些？

用户：使用jstat查看内存和GC情况，jmap导出堆转储，jstack查看线程栈，VisualVM图形化监控。生产环境用JMX或APM工具。

老师：jstat能查看哪些信息？

用户：堆内存使用情况、GC次数和时间、类加载信息等。

---

### 知识点34：什么是JVM调优？调优的主要目标是什么？

**对话：**

老师：什么是JVM调优？调优的主要目标是什么？

用户：JVM调优是通过调整参数优化JVM性能。主要目标是降低GC停顿时间、提高吞吐量、减少内存使用。需要根据应用特点进行调优。

老师：调优的基本原则是什么？

用户：先监控分析，再调整参数，最后验证效果。

---

### 知识点35：如何分析内存泄漏问题？常用的分析工具有哪些？

**对话：**

老师：如何分析内存泄漏问题？常用的分析工具有哪些？

用户：先用jstat观察内存增长趋势，再用jmap导出堆转储文件，最后用MAT或JProfiler分析。MAT可以显示对象引用链，找到泄漏根源。

老师：MAT中的Dominator Tree有什么作用？

用户：显示对象支配关系，帮助找到内存占用最大的对象。

---

### 知识点36：什么是OOM（OutOfMemoryError）？常见的OOM类型有哪些？

**对话：**

老师：什么是OOM（OutOfMemoryError）？常见的OOM类型有哪些？

用户：OOM是内存不足错误。常见类型：Java heap space堆内存不足，Metaspace元空间不足，Unable to create new native thread线程创建过多，Direct buffer memory直接内存不足。

老师：如何解决Unable to create new native thread错误？

用户：减少线程数量，或者增加系统限制。

---

### 知识点37：什么是栈溢出（StackOverflowError）？如何避免栈溢出？

**对话：**

老师：什么是栈溢出（StackOverflowError）？如何避免栈溢出？

用户：栈溢出是栈空间不足错误。通常由无限递归或方法调用嵌套过深引起。避免方法：控制递归深度，使用迭代替代递归，增加栈大小。

老师：如何增加栈大小？

用户：使用-Xss参数设置栈大小。

---

### 知识点38：什么是安全点（Safepoint）？JVM如何实现安全点？

**对话：**

老师：什么是安全点（Safepoint）？JVM如何实现安全点？

用户：安全点是JVM中线程可以安全暂停的位置。JVM在方法调用、循环跳转等位置插入安全点检查。线程执行到安全点时检查是否需要暂停。

老师：安全点有什么作用？

用户：用于垃圾回收、代码反优化、线程dump等需要暂停线程的操作。

---

### 知识点39：什么是JIT编译优化？常见的优化技术有哪些？

**对话：**

老师：什么是JIT编译优化？常见的优化技术有哪些？

用户：JIT编译优化是即时编译器对字节码进行的优化。常见技术：方法内联、逃逸分析、循环优化、公共子表达式消除等。

老师：方法内联有什么好处？

用户：减少方法调用开销，为其他优化创造机会。

---

### 知识点40：什么是逃逸分析？逃逸分析能带来哪些优化？

**对话：**

老师：什么是逃逸分析？逃逸分析能带来哪些优化？

用户：逃逸分析是分析对象的作用域。如果对象不会逃逸出方法，可以进行栈上分配、标量替换、同步消除等优化。

老师：标量替换是什么意思？

用户：将对象分解为基本类型变量，在栈上分配。

---

**今日总结：**
今天我们继续深入学习了JVM的20个进阶知识点，涵盖了垃圾收集器、类加载机制、内存管理、性能调优等核心内容。通过系统的问答学习，对JVM的内部机制有了更全面的理解，为实际应用和问题排查打下了坚实基础。